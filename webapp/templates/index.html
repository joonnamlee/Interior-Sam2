<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SAM2 Demo</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <div class="container">
    <h1>SAM2 이미지 세그멘테이션</h1>

    <div class="panel">
      <div class="controls">
        <div class="file-area">
          <label class="dropzone" id="dropzone">
            <input id="fileInput" type="file" accept="image/*" hidden />
            <span>여기에 이미지를 드래그하거나 클릭하여 선택</span>
          </label>
        </div>
        <div class="options">
          <label>모드
            <select id="mode">
              <option value="auto">자동(중앙 클릭)</option>
              <option value="points">포인트</option>
              <option value="box">박스</option>
            </select>
          </label>
          <label><input type="checkbox" id="multimask" /> 멀티 마스크</label>
          <label><input type="checkbox" id="refineDepth" /> 깊이 기반 정제</label>
          <label><input type="checkbox" id="growRegion" /> 영역 성장</label>
          <label style="display:flex;align-items:center;gap:8px;">
            허용오차 <input type="range" id="depthTol" min="0.01" max="0.2" step="0.01" value="0.08" />
            <span id="depthTolVal">0.08</span>
          </label>
          <label><input type="checkbox" id="exportPly" /> PLY 내보내기</label>
          <label><input type="checkbox" id="withSemantic" /> SegFormer(ADE20K) 오브젝트 인식</label>
          <label><input type="checkbox" id="wallDemo" /> 벽 제거 데모(레이어1/2/오버레이)</label>
          <button id="clearBtn" type="button">프롬프트 초기화</button>
          <button id="runBtn" type="button">실행</button>
        </div>
      </div>

      <div class="canvas-wrap">
        <canvas id="canvas" width="0" height="0"></canvas>
      </div>
      <div class="hint">
        - 포인트: 좌클릭=긍정, 우클릭=부정 (컨텍스트 메뉴가 뜨면 한번 더) / 박스: Shift 누른 상태로 드래그<br />
      </div>
      <div id="progress" class="progress" hidden>처리 중...</div>
    </div>

    {% if error %}
    <div class="error" style="margin-top:12px;color:#ff9b9b;">
      {{ error }}
    </div>
    {% endif %}

    <div class="main-content">
      <div id="results" class="results" hidden></div>
      <div id="palettePanel" class="palette-panel">
        <h3>색상 팔레트</h3>
        <div class="palette-grid" id="paletteGrid"></div>
        <div class="color-picker-wrap">
          <label>커스텀 색상
            <input type="color" id="customColor" value="#4f8cff" />
          </label>
        </div>
        <div class="selected-mask-info" id="maskInfo">
          <p>선택된 마스크: <span id="maskName">-</span> (<span id="maskCount">0</span>개)</p>
          <label style="display:flex;align-items:center;gap:8px;margin:8px 0;">
            투명도 <input type="range" id="alphaSlider" min="0" max="100" step="1" value="60" />
            <span id="alphaVal">60%</span>
          </label>
          <button id="colorizeBtn" type="button" disabled>색칠하기</button>
          <div style="margin-top:12px;padding-top:12px;border-top:1px solid #1b2740;">
            <button id="undoBtn" type="button" disabled style="width:100%;margin-bottom:4px;background:#666;">되돌리기</button>
            <button id="redoBtn" type="button" disabled style="width:100%;background:#666;">다시하기</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="/static/app.js"></script>
</body>
</html>


